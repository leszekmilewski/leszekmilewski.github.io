<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Wojna – gra karciana</title>
  <style>
    body {
      font-family: 'Libre Baskerville', serif;
      background: #f6f6f6;
      color: #111;
      text-align: center;
      padding: 2rem;
    }

    h1 {
      font-size: 2rem;
      margin-bottom: 1rem;
    }

    select, button {
      font-size: 1rem;
      padding: 0.5rem 1rem;
      margin: 0.5rem;
    }

    .cards {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin: 2rem 0;
      gap: 1rem;
    }

    .card {
      background: #fff;
      border: 1px solid #ccc;
      padding: 1rem;
      min-width: 70px;
      border-radius: 5px;
      font-size: 1.2rem;
    }

    .card strong {
      display: block;
      margin-top: 0.5rem;
      font-size: 0.9rem;
    }

    @media (max-width: 600px) {
      .card {
        min-width: 60px;
        font-size: 1rem;
        padding: 0.8rem;
      }
    }
  </style>
</head>
<body>
  <h1>Wojna – gra karciana</h1>
  <label for="opponents">Wybierz liczbę przeciwników:</label>
  <select id="opponents">
    <option value="1">1 komputer</option>
    <option value="2">2 komputery</option>
    <option value="3">3 komputery</option>
  </select>
  <button onclick="startGame()">Rozpocznij grę</button>
  <button onclick="playRound()">Rozegraj turę</button>

  <p id="status"></p>
  <div class="cards" id="cards"></div>
  <p id="result"></p>

  <script>
    const suits = ['♠', '♥', '♦', '♣'];
    const values = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'Walet', 'Dama', 'Król', 'As'];
    const valueMap = { '2': 2, '3': 3, '4': 4, '5': 5, '6': 6, '7': 7, '8': 8, '9': 9, '10': 10, 'Walet': 11, 'Dama': 12, 'Król': 13, 'As': 14 };

    let players = [];
    let roundCount = 0;
    let drawCount = 0;

    function createDeck() {
      let deck = [];
      for (let suit of suits) {
        for (let val of values) {
          deck.push({ value: val, suit: suit });
        }
      }
      return deck.sort(() => Math.random() - 0.5);
    }

    function startGame() {
      const numOpponents = parseInt(document.getElementById('opponents').value);
      const deck = createDeck();
      players = Array(numOpponents + 1).fill().map(() => []);
      let i = 0;
      while (deck.length) {
        players[i % players.length].push(deck.pop());
        i++;
      }
      roundCount = 0;
      drawCount = 0;
      document.getElementById('result').textContent = '';
      document.getElementById('cards').innerHTML = '';
      updateStatus();
    }

    function updateStatus() {
      const names = ['Gracz', ...players.slice(1).map((_, i) => `Komputer ${i + 1}`)];
      const cardsDiv = document.getElementById('cards');
      cardsDiv.innerHTML = '';
      names.forEach((name, i) => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `—<strong>${name} (karty: ${players[i].length})</strong>`;
        cardsDiv.appendChild(card);
      });
      document.getElementById('status').textContent = `Runda: ${roundCount} | Remisów: ${drawCount}`;
    }

    function playRound(warPile = []) {
      if (players.some(p => p.length === 0)) {
        document.getElementById('result').textContent = 'Gra zakończona!';
        return;
      }

      const current = players.map(p => p.shift());
      warPile.push(current);

      const valuesDrawn = current.map(c => (c ? valueMap[c.value] : 0));
      const max = Math.max(...valuesDrawn);
      const winners = valuesDrawn.reduce((acc, val, i) => {
        if (val === max) acc.push(i);
        return acc;
      }, []);

      roundCount++;

      const cardsDiv = document.getElementById('cards');
      cardsDiv.innerHTML = '';
      current.forEach((card, i) => {
        const div = document.createElement('div');
        div.className = 'card';
        if (card) {
          div.innerHTML = `${card.value} ${card.suit}<strong>${i === 0 ? 'Gracz' : 'Komputer ' + i} (karty: ${players[i].length})</strong>`;
        } else {
          div.innerHTML = `—<strong>${i === 0 ? 'Gracz' : 'Komputer ' + i}</strong>`;
        }
        cardsDiv.appendChild(div);
      });

      if (winners.length === 1) {
        let allCards = warPile.flat();
        allCards = allCards.filter(Boolean);
        players[winners[0]].push(...allCards);
        document.getElementById('result').textContent = `${winners[0] === 0 ? 'Gracz' : 'Komputer ' + winners[0]} wygrywa tę rundę!`;
      } else {
        drawCount++;
        document.getElementById('result').textContent = 'Remis! Wojna!';
        const enoughCards = winners.every(i => players[i].length >= 2);
        if (enoughCards) {
          const warExtra = players.map((p, i) => winners.includes(i) ? [p.shift(), p.shift()] : []);
          warPile.push(warExtra.flat());
          setTimeout(() => playRound(warPile), 1000);
          return;
        } else {
          document.getElementById('result').textContent += ' – przynajmniej jeden gracz nie ma wystarczająco kart.';
        }
      }

      updateStatus();
    }
  </script>
</body>
</html>
