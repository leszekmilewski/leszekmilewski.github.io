<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gra w Wojnę</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 1rem;
      background: #f4f4f4;
      color: #111;
    }

    h1 {
      text-align: center;
      font-size: 2rem;
      margin-bottom: 1rem;
    }

    #controls {
      text-align: center;
      margin-bottom: 1.5rem;
    }

    select, button {
      font-size: 1rem;
      padding: 0.5rem 1rem;
      margin: 0.5rem;
    }

    #roundInfo, #cardCount, #tieCount {
      text-align: center;
      margin-top: 1rem;
      font-weight: bold;
    }

    .cards {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 1rem;
      margin-top: 1.5rem;
    }

    .player {
      text-align: center;
      flex: 1 1 120px;
    }

    .card {
      background: white;
      border: 1px solid #aaa;
      padding: 1rem;
      border-radius: 8px;
      font-size: 1.2rem;
      min-width: 60px;
      margin-bottom: 0.5rem;
    }

    @media (max-width: 600px) {
      .card {
        font-size: 1rem;
        padding: 0.5rem;
      }
    }
  </style>
</head>
<body>
  <h1>Gra w Wojnę</h1>
  <div id="controls">
    <label for="playerCount">Liczba przeciwników:</label>
    <select id="playerCount">
      <option value="1">1 komputer</option>
      <option value="2">2 komputery</option>
      <option value="3">3 komputery</option>
    </select>
    <button onclick="startGame()">Nowa gra</button>
    <button onclick="playRound()">Runda</button>
  </div>

  <div id="roundInfo"></div>
  <div id="cardCount"></div>
  <div id="tieCount">Remisy: 0</div>

  <div class="cards" id="cardDisplay"></div>

  <script>
    const suits = ['♠', '♥', '♦', '♣'];
    const values = [2, 3, 4, 5, 6, 7, 8, 9, 10, 'W', 'D', 'K', 'A'];
    const valueRank = {2: 2, 3: 3, 4: 4, 5: 5, 6: 6, 7: 7, 8: 8, 9: 9, 10: 10, W: 11, D: 12, K: 13, A: 14};

    let players = [];
    let numOpponents = 1;
    let round = 0;
    let ties = 0;

    function createDeck() {
      const deck = [];
      for (let suit of suits) {
        for (let val of values) {
          deck.push({ suit, val });
        }
      }
      return deck;
    }

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    function startGame() {
      numOpponents = parseInt(document.getElementById('playerCount').value);
      const totalPlayers = numOpponents + 1;
      let deck = createDeck();
      shuffle(deck);
      players = Array.from({ length: totalPlayers }, () => []);

      for (let i = 0; i < deck.length; i++) {
        players[i % totalPlayers].push(deck[i]);
      }

      round = 0;
      ties = 0;
      document.getElementById('tieCount').textContent = `Remisy: ${ties}`;
      updateDisplay([], []);
    }

    function playRound() {
      if (players.some(p => p.length === 0)) {
        alert('Koniec gry!');
        return;
      }

      round++;
      const tableCards = [];
      const activePlayers = players.map((deck, i) => ({ i, card: deck.shift(), stack: [] }));
      for (let p of activePlayers) {
        p.stack.push(p.card);
      }

      let result = resolveRound(activePlayers, tableCards);
      for (let i = 0; i < players.length; i++) {
        if (result.winner === i) {
          players[i].push(...result.cards);
        }
      }

      if (result.tie) ties++;
      document.getElementById('tieCount').textContent = `Remisy: ${ties}`;
      updateDisplay(result.cards, result.stack || []);
    }

    function resolveRound(active, table) {
      let maxVal = Math.max(...active.map(p => valueRank[p.card.val]));
      let contenders = active.filter(p => valueRank[p.card.val] === maxVal);

      // Push revealed cards to table
      for (let p of active) {
        table.push({ player: p.i, card: p.card });
      }

      if (contenders.length === 1) {
        return { winner: contenders[0].i, cards: active.flatMap(p => p.stack), tie: false };
      }

      // Tie! WAR
      if (contenders.some(p => players[p.i].length < 2)) {
        return { winner: contenders[0].i, cards: active.flatMap(p => p.stack), tie: true };
      }

      // Everyone puts 1 down, 1 up
      for (let p of contenders) {
        if (players[p.i].length >= 2) {
          p.stack.push(players[p.i].shift()); // face-down
          p.card = players[p.i].shift(); // face-up
          p.stack.push(p.card);
        }
      }

      return resolveRound(contenders, table);
    }

    function updateDisplay(tableCards, warStack = []) {
      const container = document.getElementById('cardDisplay');
      container.innerHTML = '';
      for (let i = 0; i < players.length; i++) {
        let playerDiv = document.createElement('div');
        playerDiv.className = 'player';
        let label = i === 0 ? 'Ty' : `Komputer ${i}`;
        let cardText = tableCards.find(c => c.player === i);
        let card = cardText ? `${cardText.card.val}${cardText.card.suit}` : '—';

        let cardDiv = document.createElement('div');
        cardDiv.className = 'card';
        cardDiv.textContent = card;

        playerDiv.appendChild(cardDiv);
        playerDiv.appendChild(document.createTextNode(`${label} (${players[i].length} kart)`));
        container.appendChild(playerDiv);
      }

      document.getElementById('roundInfo').textContent = `Runda: ${round}`;
      document.getElementById('cardCount').textContent = '';
    }
  </script>
</body>
</html>
